<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>RAG Studieassistent</title>
<style>

    body {
        margin: 0;
        padding: 0;
        background: #f0f2f5;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        height: 100vh;
    }

    /* Top-bar */
    .topbar {
        background: white;
        padding: 18px 25px;
        font-size: 22px;
        font-weight: bold;
        border-bottom: 1px solid #ddd;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .topbar img {
        width: 28px;
    }

    /* Chat container */
    .chat {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
    }

    /* Message bubbles */
    .bubble {
        max-width: 80%;
        padding: 14px 16px;
        margin-bottom: 18px;
        border-radius: 12px;
        line-height: 1.5;
        white-space: pre-wrap;
    }

    .user {
        background: #d9eaff;
        align-self: flex-end;
        margin-left: auto;
    }

    .assistant {
        background: white;
        border: 1px solid #e5e5e5;
        margin-right: auto;
    }

    /* Sources box */
    .sources {
        background: #f7f7f7;
        padding: 10px;
        margin-top: 8px;
        border-radius: 6px;
        font-size: 14px;
        white-space: pre-wrap;
    }

    /* Input bar fixed at bottom */
    .inputbar {
        display: flex;
        gap: 10px;
        padding: 15px;
        background: white;
        border-top: 1px solid #ddd;
    }

    .inputbar input, .inputbar select {
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 6px;
    }

    .inputbar input {
        flex: 1;
    }

    .inputbar button {
        padding: 12px 18px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        background: #2b77ff;
        color: white;
        border-radius: 6px;
    }

</style>
</head>

<body>

<div class="topbar">
    RAG Studieassistent
</div>

<div class="chat" id="chat"></div>

<div class="inputbar">
    <input id="q" placeholder="Skriv dit spørgsmål…">
    <select id="lektion">
        <option value="Lektion_1">Lektion 1</option>
        <option value="Lektion_2">Lektion 2</option>
        <option value="Lektion_3">Lektion 3</option>
        <option value="Lektion_4">Lektion 4</option>
        <option value="Lektion_5">Lektion 5</option>
    </select>
    <button onclick="ask()">Spørg</button>
</div>

<script>

async function ask() {

    const q = document.getElementById("q").value;
    const lek = document.getElementById("lektion").value;

    if (!q.trim()) return;

    // Vis brugerens boble
    addBubble(q, "user");

    const res = await fetch("/ask", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({q: q, lektion: lek})
    });

    const data = await res.json();

    // AI svar
    addBubble(data.answer, "assistant");

    // Kilder
    let src = "";
    for (let s of data.sources) {
        src += `[${s.lektion}/${s.file}, s.${s.page}]\n`;
    }

    if (src.trim()) {
        addSources(src);
    }

    document.getElementById("q").value = "";
}

function addBubble(text, type) {
    const chat = document.getElementById("chat");
    const div = document.createElement("div");
    div.className = "bubble " + type;
    div.textContent = text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

function addSources(text) {
    const chat = document.getElementById("chat");
    const div = document.createElement("div");
    div.className = "sources";
    div.innerHTML = "<b>Kilder:</b><br>" + text;
    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
}

</script>

</body>
</html>